<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>FriendFinder</title>

	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<!-- Font Awesome Glyphicons -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

	<!-- Chosen -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>

</head>
<body>

	<div class="container">

		<h2>BS Questions</h2>
		<hr>

		<h3><strong>About You</strong></h3>
		<h4>Name (Required)</h4>
		<input type="text" name="" id="name" class="form-control" required >


		<h3><strong>Question 1</strong></h3>
		<h4>The moon landing was very clearly a hoax.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q1">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 2</strong></h3>
		<h4>Spock is superior to Capitain Kirk.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q2">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 3</strong></h3>
		<h4>Leanard Nemoy is superior to William Shatner.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q3">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 4</strong></h3>
		<h4>Wolverine is overrrated.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q4">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 5</strong></h3>
		<h4>Michael Jackson was replaced with aliens long before he died. His death was the aliens leaving the planet.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q5">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 6</strong></h3>
		<h4>Robots are takin arr jabs!</h4>
	 	<select data-placeholder="" class="chosen-select" id="q6">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 7</strong></h3>
		<h4>AI will be our DOOM.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q7">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 8</strong></h3>
		<h4>Scientology is the one and only truth.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q8">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 9</strong></h3>
		<h4>Liam Neason is the shit!</h4>
	 	<select data-placeholder="" class="chosen-select" id="q9">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 10</strong></h3>
		<h4>Kung Fu over Karate.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q10">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<br>
		<br>

		<!-- Submit Button -->
		<button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i>
 Submit</button>

	   

	</div>

	<!-- Modal -->
	<div id="resultsModal" class="modal fade" role="dialog">
	  <div class="modal-dialog">

	    <!-- Modal content-->
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h2 class="modal-title"><strong>Here's someone you might not hate!</strong></h2>
	      </div>
	      <div class="modal-body">
	        <h2 id="matchName"></h2>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close this stupid pop-up</button>
	      </div>
	    </div>

	  </div>
	</div>

  <script type="text/javascript">
  	// CSS Config
    var config = {
      '.chosen-select'           : {},
      '.chosen-select-deselect'  : {allow_single_deselect:true},
      '.chosen-select-no-single' : {disable_search_threshold:10},
      '.chosen-select-no-results': {no_results_text:'No friends for you homie! Reevaluate your life choices.'},
      '.chosen-select-width'     : {width:"95%"}
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }


    
    var friends;
	//get request to get friends objects
    $.get("/api/friends", function(response){
        friends = response
        console.log("get friends request:", friends)
    })

    

    // Capture input from forms 
    $("#submit").on("click", function(){
    	// Form validation
    	function validateForm() {
		  var isValid = true;
		  $('.form-control').each(function() {
		    if ( $(this).val() === '' )
		        isValid = false;
		  });
		  $('.chosen-select').each(function() {
		  	if( $(this).val() === "")
		  		isValid = false
		  })
		  return isValid;
		}
	
		if (validateForm() == true)
		{
			// Create user object data, get info from form
	    	var userData = {
	    		name: $("#name").val(),
	    		photo: $("#photo").val(),
	    		scores: [$("#q1").val(), $("#q2").val(), $("#q3").val(), $("#q4").val(), $("#q5").val(), $("#q6").val(), $("#q7").val(), $("#q8").val(), $("#q9").val(), $("#q10").val(), ]
            }
		   
			// Create var array for current user scores
            var myValues = userData.scores
            console.log("friends:", friends)
            console.log("User Data: current user object", userData)
            console.log("MyValues: current user scores array",myValues)



            var arrayFriendsScores = []
            // for loops takes all individual friend scores and pushes them into single array
            for(i=0;i<friends.length;i++){
                arrayFriendsScores.push(friends[i].scores)
			}
			
			//empty diffence array 
			var difference = []


   // This for loop goes through the array of all friends scores and compares them to my scores. After the comparison is made it pushes all the values to the difference array
   for (var j = 0; j < arrayFriendsScores.length; j++) {
     for (var i = 0; i < arrayFriendsScores[j].length; i++) {
       if (arrayFriendsScores[j][i] > myValues[i]){
          // console.log( arrayFriendsScores[j][i] + ' was greater than ' + myValues[i])
          // console.log('the diff is ', arrayFriendsScores[j][i] - myValues[i]);
          difference.push(arrayFriendsScores[j][i] - myValues[i])
       } else if (arrayFriendsScores[j][i] > myValues[i]){
          // console.log( arrayFriendsScores[j][i] + ' was less than ' + myValues[i])
          // console.log('the diff is ', myValues[i] - arrayFriendsScores[j][i])
          difference.push(myValues[i] - arrayFriendsScores[j][i])
       } else {
         // console.log( arrayFriendsScores[j][i] + ' is equal to ' + myValues[i])
         // console.log('the diff is ', 0)
         difference.push(0)
       }
	 }
   }
	 console.log("difference array:", difference)


    // Empty array for next loop
	  var differnceSmallerArray = []

	// this divides the big difference score array back in several arrays of 10 each
   var size = 10;
   for (var i=0; i<difference.length; i+=size) {
      var smallarray = difference.slice(i,i+size);
      differnceSmallerArray.push(smallarray)
   }
   console.log("differenceSmallerArray:", differnceSmallerArray)
   

    // Empty array for next loop
	var sumDiffs = []
    // Sum each of the smaller arrays for a total difference for each person and push into sumDiffs
    for (var i = 0; i < differnceSmallerArray.length; i++) {
      function getSum(total, num) {
          return total + num;
      }
      sumDiffs.push(differnceSmallerArray[i].reduce(getSum))
    }
    console.log("sumDiffs:", sumDiffs);



	 // which array has the smallest difference?
    var index = 0;
    var value = sumDiffs[0];
    for (var i = 1; i < sumDiffs.length; i++) {
      if (sumDiffs[i] < value) {
        value = sumDiffs[i];
        index = i;
      }
	}
	

	// Empty array for next loop
	var chosenFriend = []

	console.log("friends.friends", friends.friends)
	//loop through friends (array) and push friend that mathes index from last step
    chosenFriend.push(friends[index])
	console.log(`smallest is ${value} and the index is ${index}`);
	console.log("chosen friend", chosenFriend);
    console.log("chosenFriend at 0:", chosenFriend[0]);





            console.log("Array of friends scores:", arrayFriendsScores)
			//puts results in modal pop up 	
			//$("#resultsModal").modal()
			



		$('.modal-body').html(
    		 `
   		 <h1>${chosenFriend[0].name}</h1>
  		<img src="${chosenFriend[0].photo}">
     		`
   			)
  		$('#resultsModal').modal()




		}
		else
		{
			alert("Answer all the questions you friendless fool!");
		}
    	
    	return false;
	});


  </script>

</body>
</html>